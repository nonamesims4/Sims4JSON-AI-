<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>Sims4 JSON リライトツール（シムっぽい）</title>
<style>
body { font-family: sans-serif; margin: 20px; background:#f5f5f5; }
h1 { color: #444; }
textarea { width:100%; height:200px; }
button { padding:10px 20px; margin:5px; cursor:pointer; }
#output { white-space: pre-wrap; background:#fff; padding:10px; border:1px solid #ccc; margin-top:10px; }
</style>
</head>
<body>
<h1>Sims4 JSON リライトツール（シム風サンプル付き）</h1>
<input type="file" id="fileInput"><br>
<button id="processBtn">リライト整形</button>
<button id="downloadBtn">JSONダウンロード</button>
<div id="output"></div>

<script>
// タグ正規化
function normalizeTags(text) {
    let TAG_REPLACEMENTS = [
        [/\{M0\.(HE|HIS)\b/gi, '{M0.彼}'],
        [/\{F0\.(SHE|HER)\b/gi, '{F0.彼女}'],
        [/\{M1\.(HE|HIS)\b/gi, '{M1.彼}'],
        [/\{F1\.(SHE|HER)\b/gi, '{F1.彼女}'],
        [/\{0\.SIMFIRSTNAME\}/gi, '{0.SimFirstName}'],
        [/\{1\.SIMFIRSTNAME\}/gi, '{1.SimFirstName}'],
        [/\{0\.SIMPRONOUN\w+\}/gi, '{M0.彼}{F0.彼女}'],
        [/\{F0\.彼女\}の/gi, '{F0.彼女}'],
        [/\{M0\.彼\}の/gi, '{M0.彼}'],
        [/\{[FM]0\.彼女?\}[がはを]/gi, match=>match.slice(0,-1)],
        [/\{[FM]\d\.[^}]+\}\1+/gi, match=>match[0]],
    ];
    TAG_REPLACEMENTS.forEach(([pattern,repl])=>{
        text = text.replace(pattern,repl);
    });
    // タグ大文字化
    text = text.replace(/\{([^}]+)\}/g, m => '{' + m.slice(1,-1).toUpperCase() + '}');
    return text;
}

// シムっぽい文章リライト例
function rewriteSimStyle(text){
    // ここで文章のニュアンスを少し柔らかくする例
    return text
        .replace(/フェアリー/g, '小さな妖精')
        .replace(/魔力/g, '魔法のエネルギー')
        .replace(/翼を使って空を飛べます/g, 'ふわりと空を舞います')
        .replace(/特別な力を持つ/g, '不思議な力を秘めた')
        .replace(/魔法エネルギーを回復します/g, '魔法の力をゆっくり取り戻します');
}

// アスタリスク除去
function cleanAsterisks(text){
    return text.replace(/^\s*\*+\s*|\s*\*+\s*$/g,'');
}

let jsonData = null;

document.getElementById('fileInput').addEventListener('change', function(e){
    const file = e.target.files[0];
    const reader = new FileReader();
    reader.onload = function(evt){
        try {
            jsonData = JSON.parse(evt.target.result);
            document.getElementById('output').textContent = JSON.stringify(jsonData,null,2);
        } catch(err){
            alert('JSON解析エラー');
        }
    }
    reader.readAsText(file,'utf-8');
});

document.getElementById('processBtn').addEventListener('click', function(){
    if(!jsonData){ alert('JSONを読み込んでください'); return; }
    jsonData.Entries.forEach(entry=>{
        if(entry.Value){
            let text = normalizeTags(entry.Value);
            text = cleanAsterisks(text);
            text = rewriteSimStyle(text);
            entry.Value = text; // リライト整形
        }
    });
    document.getElementById('output').textContent = JSON.stringify(jsonData,null,2);
});

document.getElementById('downloadBtn').addEventListener('click', function(){
    if(!jsonData){ alert('JSONを処理してください'); return; }
    const blob = new Blob([JSON.stringify(jsonData,null,2)], {type:'application/json'});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'relit_sims4.json';
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
});
</script>
</body>
</html>
